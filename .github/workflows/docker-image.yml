name: Build and Run Docker Container

on:
  push:
    branches:
      - main

jobs:
  build-and-run:
    runs-on: ubuntu-latest

    steps:
    # Sprawdź kod z repozytorium
    - name: Checkout code
      uses: actions/checkout@v3

    # Budowanie obrazu Docker
    - name: Build Docker image
      run: |
        docker build -t my-docker-image:latest .

     # Testowanie podatności obrazu przy użyciu Docker Scout
    - name: Analyze vulnerabilities with Docker Scout
      uses: docker/scout-action@v1
      with:
        image: my-docker-image:latest
        token: ${{ secrets.DOCKER_ACCESS_TOKEN }}

    # Uruchomienie kontenera
    - name: Run Docker container
      run: |
        docker run -d -p 8081:8081 -e PORT=8081 --name my-docker-container my-docker-image:latest

    - name: Wait for the server to start
      run: sleep 5

    - name: Print Docker container logs
      run: docker logs my-docker-container
      
    # Sprawdzenie działania kontenera
    - name: Test Container
      run: |
        curl http://localhost:8081

